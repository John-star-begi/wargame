<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Executives War Game — Class A Fix</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Roboto font -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel (JSX in-browser) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Recharts -->
 <script src="https://unpkg.com/recharts@2.10.3/umd/Recharts.min.js"></script>

  <style>
    :root{
      --c-bg:#F9FBFC;
      --c-primary:#76CAE3;   /* sky blue */
      --c-navy:#1E3A8A;      /* navy */
      --c-lav:#D9E7F1;       /* lavender */
      --c-mint:#42B77E;      /* success */
      --c-amber:#FFB84D;     /* warning */
      --c-coral:#E84855;     /* error */
      --c-text:#0f172a;      /* slate-900-ish */
      --radius:14px;         /* 12–16px sweet spot */
      --shadow:0 2px 6px rgba(0,0,0,.05);
      --shadow-hover:0 6px 18px rgba(0,0,0,.08);
      --gutter:24px;
      --transition:150ms cubic-bezier(.2,.7,.2,1);
    }
    html,body{height:100%;}
    body{
      background:var(--c-bg);
      color:var(--c-text);
      font-family: "Roboto", system-ui, -apple-system, Segoe UI, Arial, sans-serif;
    }

    .wrap{ padding:16px; }
    @media(min-width:768px){ .wrap{ padding:var(--gutter); } }

    .ui-card{
      background:#fff;
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      transition:transform var(--transition), box-shadow var(--transition), background var(--transition);
    }
    .ui-card:hover{ box-shadow:var(--shadow-hover); }

    .ui-title{ font-weight:700; font-size:22px; color:var(--c-navy); }
    .ui-sub{ font-weight:500; font-size:16px; color:#475569; }
    .ui-body{ font-weight:400; font-size:14px; }

    .btn{
      position:relative; overflow:hidden;
      display:inline-flex; align-items:center; justify-content:center; gap:.5rem;
      border:none; border-radius:12px; padding:.625rem 1rem;
      font-weight:600; transition: transform var(--transition), background var(--transition);
      box-shadow: none; will-change: transform;
    }
    .btn:hover{ transform: scale(1.02); }
    .btn:active{ transform: scale(0.99); }
    .btn--primary{ background:var(--c-primary); color:#083344; }
    .btn--navy{ background:var(--c-navy); color:#fff; }
    .btn--ghost{ background:#fff; color:var(--c-navy); border:1px solid #e5e7eb; }
    .ripple { position:absolute; border-radius:50%; transform: scale(0);
      animation: ripple 500ms ease-out; background: rgba(255,255,255,.35); pointer-events:none; }
    @keyframes ripple { to { transform: scale(4); opacity: 0; } }

    .ui-input, .ui-select{
      width:100%; background:#fff; border:1px solid #e5e7eb; border-radius:12px;
      padding:.55rem .75rem; outline:none;
      transition: box-shadow var(--transition), border-color var(--transition), transform var(--transition);
    }
    .ui-input:focus, .ui-select:focus{
      border-color: var(--c-primary);
      box-shadow: 0 0 0 3px rgba(118,202,227,.25);
    }
    .ui-label{ font-size:12px; color:#64748b; margin-bottom:.25rem; display:block; }

    .kpi-title{ font-size:13px; color:#64748b; }
    .kpi-value{ font-weight:700; font-size:18px; }

    .pill{ border-radius:999px; padding:.35rem .75rem; font-weight:600; font-size:13px;
      border:1px solid #e5e7eb; background:#fff; color:#0b2e57; transition: all var(--transition); }
    .pill:hover{ box-shadow:var(--shadow); transform: translateY(-1px); }
    .pill--active{ background:var(--c-primary); border-color:transparent; color:#083344; }

    .tabs{ display:flex; gap:.5rem; flex-wrap:wrap; }
    .tab-btn{
      position:relative; padding:.5rem .8rem; border-radius:10px; background:#fff; border:1px solid #e5e7eb;
      color:#0b2e57; font-weight:600; transition: background var(--transition), transform var(--transition), box-shadow var(--transition);
    }
    .tab-btn:hover{ transform: translateY(-1px); box-shadow:var(--shadow); }
    .tab-btn.active{ background:var(--c-navy); color:#fff; }
    .tab-btn.active::after{
      content:""; position:absolute; left:12px; right:12px; bottom:-2px; height:3px; border-radius:3px;
      background:linear-gradient(90deg, var(--c-primary), var(--c-lav));
      transform-origin:left; animation: underline .25s ease-out forwards;
    }
    @keyframes underline{ from{ transform:scaleX(0) } to{ transform:scaleX(1) } }

    .badge{ display:inline-flex; align-items:center; gap:.4rem; font-size:12px; font-weight:700; letter-spacing:.2px;
      padding:.2rem .6rem; border-radius:999px; }
    .badge--success{ background:rgba(66,183,126,.12); color:var(--c-mint); }
    .badge--warn{ background:rgba(255,184,77,.15); color:#b06f00; }
    .badge--error{ background:rgba(232,72,85,.12); color:var(--c-coral); }
    .badge--info{ background:rgba(118,202,227,.15); color:#0b2e57; }

    .chart-h { height: 320px; }
    .grid-cards{ display:grid; gap:16px; }
    @media(min-width:768px){ .grid-cards{ grid-template-columns:repeat(2,minmax(0,1fr)); gap:16px; } }
    @media(min-width:1024px){ .grid-cards{ grid-template-columns:repeat(4,minmax(0,1fr)); gap:16px; } }
  </style>
</head>
<body>
  <div id="root" class="wrap max-w-[1200px] mx-auto"></div>

<script type="text/babel" data-presets="react">
    const { useMemo, useState, useEffect } = React;
    const {
      LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer,
      CartesianGrid, Legend, BarChart, Bar, AreaChart, Area
    } = Recharts;

    // —— Utils
    const fmtMoney = (n)=> (isFinite(n)? n.toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:0}) : '—');
    const fmtInt   = (n)=> (isFinite(n)? Math.round(n).toLocaleString() : '—');
    const clamp = (v,min,max)=> Math.max(min, Math.min(max, v));
    const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

    // Ripple helper
    function useRipple(){
      useEffect(()=>{
        const onClick = (e)=>{
          const btn = e.target.closest('.btn');
          if(!btn) return;
          const rect = btn.getBoundingClientRect();
          const size = Math.max(rect.width, rect.height);
          const ripple = document.createElement('span');
          ripple.className = 'ripple';
          ripple.style.width = ripple.style.height = size + 'px';
          ripple.style.left = (e.clientX - rect.left - size/2) + 'px';
          ripple.style.top  = (e.clientY - rect.top  - size/2) + 'px';
          btn.appendChild(ripple);
          setTimeout(()=> ripple.remove(), 500);
        };
        document.addEventListener('click', onClick);
        return ()=> document.removeEventListener('click', onClick);
      },[]);
    }

    // Inputs
    function NumberInput({ label, value, onChange, step = 1, min, max, right=true }) {
      const [text, setText] = React.useState(String(value ?? ''));
      React.useEffect(()=>{ setText(String(value ?? '')); }, [value]);
      const handleChange = (e) => {
        const raw = e.target.value;
        setText(raw);
        const cleaned = raw.replace(/[^0-9.]/g, '');
        if (cleaned === '') { if(min!=null) onChange(min); else onChange(0); return; }
        let num = Number(cleaned);
        if (!Number.isFinite(num)) return;
        if (min!=null) num = Math.max(min, num);
        if (max!=null) num = Math.min(max, num);
        onChange(num);
      };
      return (
        <div>
          <label className="ui-label">{label}</label>
          <input
            className="ui-input"
            type="text"
            inputMode="decimal"
            value={text}
            onChange={handleChange}
            placeholder="Enter number…"
            style={{ textAlign: right ? 'right' : 'left' }}
          />
        </div>
      );
    }

    function PercentInput({ label, value, onChange, min=0, max=1 }) {
      // value stored as fraction (e.g. 0.08). Show as percent.
      const [text, setText] = React.useState(String((value*100).toFixed(2)));
      useEffect(()=> setText(String((value*100).toFixed(2))), [value]);
      const handle = (e)=>{
        const raw = e.target.value.replace(/[^0-9.]/g,'');
        setText(raw);
        if(raw===''){ onChange(min); return; }
        let pct = Number(raw); if(!Number.isFinite(pct)) return;
        pct = clamp(pct, min*100, max*100);
        onChange(pct/100);
      };
      return (
        <div>
          <label className="ui-label">{label}</label>
          <div className="flex items-center gap-2">
            <input className="ui-input" type="text" inputMode="decimal" value={text} onChange={handle} style={{textAlign:'right'}} />
            <span className="text-slate-500">%</span>
          </div>
        </div>
      );
    }

    function Toggle({label, checked, onChange}){
      return (
        <label className="flex items-center gap-2 select-none">
          <input type="checkbox" className="scale-110 accent-[var(--c-primary)]" checked={checked} onChange={(e)=> onChange(e.target.checked)} />
          <span className="ui-sub">{label}</span>
        </label>
      );
    }

    function ExecutivesWarGame(){
      useRipple();

      // ======= Assumptions (editable) =======
      const [npTarget, setNpTarget] = useState(1_000_000);

      // Unit economics
      const [revenuePerPMAnnual, setRevenuePerPMAnnual] = useState(40000); // $ per PM per YEAR (base, M1)
      const [gpPct, setGpPct] = useState(0.275);
      const [netMargin, setNetMargin] = useState(0.125);

      // Ops conversion (for staffing)
      const [revenuePerApprovedJob, setRevPerApprovedJob] = useState(653.6);
      const [approval, setApproval] = useState(0.55); // approved / sent

      // Sales motion
      const [closeRate, setCloseRate] = useState(0.90);
      const [pmsPerAgency, setPmsPerAgency] = useState(4);

      // Churn / Expansion (monthly)
      const [churnRate, setChurnRate] = useState(0.08);      // 8%/mo default
      const [expansionRate, setExpansionRate] = useState(0.01); // 1%/mo default

      // Meetings schedule
      const [useCustomSchedule, setUseCustomSchedule] = useState(true);
      const [defaultMeetings, setDefaultMeetings] = useState(4);
      const [schedule12, setSchedule12] = useState(Array(12).fill(4)); // Jan..Dec
      const simMonths = 36; // 3 years

      // Staffing ratios
      const [dispatcherCapacityYear, setDispatcherCapacityYear] = useState(1440); // jobs/year
      const [tlPerDispatchers, setTlPerDispatchers] = useState(4);
      const [omPerTls, setOmPerTls] = useState(4);
      const [amPerPM, setAmPerPM] = useState(30);

      // ======= Derived helpers =======
      const monthlyFromAnnual = (annual)=> annual/12;

      const meetingsByMonth = useMemo(()=>{
        const arr = [];
        for(let t=0;t<simMonths;t++){
          const mIdx = t % 12;
          const mtgs = useCustomSchedule ? schedule12[mIdx] : defaultMeetings;
          arr.push(mtgs);
        }
        return arr;
      }, [useCustomSchedule, schedule12, defaultMeetings]);

      const newPMsByMonth = useMemo(()=>{
        return meetingsByMonth.map(mtgs => mtgs * closeRate * pmsPerAgency);
      }, [meetingsByMonth, closeRate, pmsPerAgency]);

      // ======= Core Simulation (Monthly Engine) =======
      const sim = useMemo(()=>{
        const rows = [];
        let activePM = 0;
        let revPM_month = monthlyFromAnnual(revenuePerPMAnnual); // starting monthly revenue per PM
        let cumRevenue = 0, cumNP = 0, cumGP = 0;
        let totalJobsSent = 0, totalJobsApproved = 0;

        for(let t=0;t<simMonths;t++){
          const addPM = newPMsByMonth[t] || 0;

          // base carry-forward + churn + acquisition
          activePM = activePM * (1 - churnRate) + addPM;

          // expansion on per-PM revenue (global run-rate growth)
          revPM_month = revPM_month * (1 + expansionRate);

          const revenue = activePM * revPM_month;
          const gp = revenue * gpPct;
          const np = revenue * netMargin;

          // jobs / staffing drivers
          const jobsApproved = revenue / revenuePerApprovedJob;
          const jobsSent = jobsApproved / approval;

          cumRevenue += revenue; cumGP += gp; cumNP += np;
          totalJobsApproved += jobsApproved; totalJobsSent += jobsSent;

          rows.push({
            t: t+1,
            monthName: months[t%12],
            addPM,
            activePM,
            revPM_month,
            revenue, gp, np,
            cumRevenue, cumGP, cumNP,
            jobsApproved, jobsSent
          });
        }

        // Yearly rollups (purely reporting / grouping)
        const year = (y)=> rows.slice((y-1)*12, y*12);
        const ySum = (y, k)=> year(y).reduce((a,b)=> a + (b[k]||0), 0);

        const years = [1,2,3].map(y=>({
          year: y,
          revenue: ySum(y, 'revenue'),
          gp: ySum(y, 'gp'),
          np: ySum(y, 'np'),
          jobsApproved: ySum(y, 'jobsApproved'),
          jobsSent: ySum(y, 'jobsSent'),
          endActivePM: year(y).length ? year(y)[year(y).length-1].activePM : 0
        }));

        return { rows, years };
      }, [
        simMonths, newPMsByMonth, churnRate, expansionRate,
        gpPct, netMargin, revenuePerPMAnnual, revenuePerApprovedJob, approval
      ]);

      const { rows, years } = sim;

      // ======= KPI & Staffing =======
      const y1 = years[0] || {revenue:0,gp:0,np:0,jobsSent:0, jobsApproved:0, endActivePM:0};
      const y2 = years[1] || {revenue:0,gp:0,np:0,jobsSent:0, jobsApproved:0, endActivePM:0};
      const y3 = years[2] || {revenue:0,gp:0,np:0,jobsSent:0, jobsApproved:0, endActivePM:0};

      // Staffing computed per-year based on year totals
      const staffFor = (yr)=> {
        const dispatchers = Math.max(1, Math.ceil(yr.jobsSent / dispatcherCapacityYear));
        const tls = Math.max(1, Math.ceil(dispatchers / tlPerDispatchers));
        const oms = Math.max(1, Math.ceil(tls / omPerTls));
        const ams = Math.max(1, Math.ceil((yr.endActivePM) / amPerPM)); // PMs supported by AMs
        return { dispatchers, tls, oms, ams };
      };
      const staffY1 = staffFor(y1), staffY2 = staffFor(y2), staffY3 = staffFor(y3);

      // ======= Goal Tracker =======
      const firstIdx = (arr, pred)=> {
        for(let i=0;i<arr.length;i++){ if(pred(arr[i], i)) return i; }
        return -1;
      };
      const cumNPs = rows.map(r=> r.cumNP);
      const rolling1M_monthIdx = firstIdx(cumNPs, v=> v >= 1_000_000);
      const monthlyNP_100k_monthIdx = firstIdx(rows, r=> r.np >= 100_000);

      const yearlyNPs = years.map(y=> y.np);
      const annual1M_yearIdx = years.findIndex(y=> y.np >= 1_000_000);

      // ======= Tabs =======
      const [tab, setTab] = useState("dashboard");

      // Export CSV
      const exportCSV = ()=>{
        const lines = [];
        lines.push("t,Month,Add PM,Active PM,Rev/PM (mo),Revenue,GP,NP,CumRevenue,CumGP,CumNP,JobsApproved,JobsSent");
        rows.forEach(r=>{
          lines.push([r.t, r.monthName, Math.round(r.addPM), Math.round(r.activePM), Math.round(r.revPM_month),
            Math.round(r.revenue), Math.round(r.gp), Math.round(r.np),
            Math.round(r.cumRevenue), Math.round(r.cumGP), Math.round(r.cumNP),
            Math.round(r.jobsApproved), Math.round(r.jobsSent)
          ].join(","));
        });
        lines.push("");
        lines.push("Year,Revenue,GP,NP,JobsApproved,JobsSent,End Active PM");
        years.forEach(y=>{
          lines.push([y.year, Math.round(y.revenue), Math.round(y.gp), Math.round(y.np),
            Math.round(y.jobsApproved), Math.round(y.jobsSent), Math.round(y.endActivePM)].join(","));
        });
        const blob = new Blob([lines.join("\n")], {type:'text/csv;charset=utf-8;'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'Executives_WarGame.csv'; a.click();
        URL.revokeObjectURL(url);
      };

      // UI labels
      const L = {
        npTarget: "NP Target",
        revPerPM: "Revenue per PM (per YEAR)",
        gpPct: "Gross Profit %",
        netMargin: "Net Margin %",
        revPerApprovedJob: "Revenue / Approved Job",
        approval: "Approval %",
        closeRate: "Close Rate (in-meeting)",
        pmsPerAgency: "PMs per Agency",
        churnRate: "Monthly Churn %",
        expansionRate: "Monthly Expansion %",
        meetingsDefault: "Default Meetings / Month",
        useCustom: "Use Custom Monthly Schedule",
        dispatcherCapacityYear: "Dispatcher Capacity / Year",
        tlPerDispatchers: "TLs per Dispatcher",
        omPerTls: "OMs per TL",
        amPerPM: "PMs per AM"
      };

      return (
        <div className="space-y-6">
          {/* Header */}
          <div className="flex items-center justify-between gap-3">
            <div>
              <div className="ui-title">Executives War Game — Class A Fix</div>
              <div className="ui-sub mt-1">Multi-year, banker-grade growth simulator (with churn, expansion, and goals)</div>
            </div>
            <div className="flex items-center gap-2">
              <span className="badge badge--info">Internal</span>
              <button className="btn btn--primary" onClick={exportCSV}>Export CSV</button>
              <button className="btn btn--navy" onClick={()=> setTab('dashboard')}>Dashboard</button>
            </div>
          </div>

          {/* Controls */}
          <div className="ui-card p-4 md:p-5 space-y-4">
            <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">
              <NumberInput label={L.npTarget} value={npTarget} onChange={setNpTarget} min={0} />
              <NumberInput label={L.revPerPM} value={revenuePerPMAnnual} onChange={setRevenuePerPMAnnual} min={5000} max={200000} />
              <PercentInput label={L.gpPct} value={gpPct} onChange={setGpPct} />
              <PercentInput label={L.netMargin} value={netMargin} onChange={setNetMargin} />

              <NumberInput label={L.revPerApprovedJob} value={revenuePerApprovedJob} onChange={setRevPerApprovedJob} min={1} />
              <PercentInput label={L.approval} value={approval} onChange={setApproval} />
              <PercentInput label={L.closeRate} value={closeRate} onChange={setCloseRate} />
              <NumberInput label={L.pmsPerAgency} value={pmsPerAgency} onChange={setPmsPerAgency} min={1} />

              <PercentInput label={L.churnRate} value={churnRate} onChange={setChurnRate} />
              <PercentInput label={L.expansionRate} value={expansionRate} onChange={setExpansionRate} />

              <NumberInput label={L.meetingsDefault} value={defaultMeetings} onChange={setDefaultMeetings} min={0} />
              <div className="flex items-center gap-3">
                <Toggle label={L.useCustom} checked={useCustomSchedule} onChange={setUseCustomSchedule} />
                {useCustomSchedule ? <span className="badge badge--success">Custom</span> : <span className="badge badge--info">Default</span>}
              </div>

              <NumberInput label={L.dispatcherCapacityYear} value={dispatcherCapacityYear} onChange={setDispatcherCapacityYear} min={100} />
              <NumberInput label={L.tlPerDispatchers} value={tlPerDispatchers} onChange={setTlPerDispatchers} min={1} />
              <NumberInput label={L.omPerTls} value={omPerTls} onChange={setOmPerTls} min={1} />
              <NumberInput label={L.amPerPM} value={amPerPM} onChange={setAmPerPM} min={1} />
            </div>

            {useCustomSchedule && (
              <>
                <div className="ui-sub mt-4">Custom Monthly Meetings (applies to each year)</div>
                <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                  {months.map((m,i)=>(
                    <div key={m}>
                      <label className="ui-label">{m} — Meetings</label>
                      <input className="ui-input" type="number" value={schedule12[i]}
                        onChange={(e)=>{
                          const v = Number(e.target.value||0);
                          setSchedule12(prev => prev.map((x,idx)=> idx===i? v: x));
                        }} />
                    </div>
                  ))}
                </div>
              </>
            )}
          </div>

          {/* KPI Cards (Year 1) */}
          <div className="grid-cards">
            {[{t:'Year 1 Revenue',v:fmtMoney(y1.revenue)},
              {t:'Year 1 GP',v:fmtMoney(y1.gp)},
              {t:'Year 1 NP',v:fmtMoney(y1.np)},
              {t:'Year 1 End Active PM',v:fmtInt(y1.endActivePM)}].map((k)=> (
              <div className="ui-card p-4" key={k.t}>
                <div className="kpi-title">{k.t}</div>
                <div className="kpi-value mt-1">{k.v}</div>
              </div>
            ))}
          </div>

          {/* Tabs */}
          <div className="tabs">
            {[
              {id:'dashboard',label:'Dashboard'},
              {id:'staffing',label:'Staffing (per Year)'},
              {id:'goals',label:'Goal Tracker'},
              {id:'details',label:'Monthly Details'}
            ].map(t=> (
              <button key={t.id} className={`tab-btn ${tab===t.id? 'active':''}`} onClick={()=> setTab(t.id)}>{t.label}</button>
            ))}
          </div>

          {/* DASHBOARD */}
          {tab==='dashboard' && (
            <>
              <div className="ui-card p-4 md:p-5">
                <div className="ui-sub mb-3">Rolling Cumulative NP (Months 1–36)</div>
                <div className="chart-h">
                  <ResponsiveContainer>
                    <LineChart data={rows}>
                      <CartesianGrid strokeDasharray="3 3" />
                      <XAxis dataKey="t" />
                      <YAxis />
                      <Tooltip formatter={(v)=> typeof v === 'number' ? fmtMoney(v) : v} />
                      <Legend />
                      <Line type="monotone" dataKey="cumNP" name="Cum NP (rolling)" stroke="#1E3A8A" strokeWidth={2} dot={false} />
                      <Line type="monotone" dataKey="cumRevenue" name="Cum Revenue (rolling)" stroke="#76CAE3" strokeWidth={2} dot={false} />
                    </LineChart>
                  </ResponsiveContainer>
                </div>
              </div>

              <div className="ui-card p-4 md:p-5 mt-4">
                <div className="ui-sub mb-3">Active PM Base & Revenue per PM/month (expanding)</div>
                <div className="chart-h">
                  <ResponsiveContainer>
                    <LineChart data={rows}>
                      <CartesianGrid strokeDasharray="3 3" />
                      <XAxis dataKey="t" />
                      <YAxis />
                      <Tooltip formatter={(v)=> typeof v === 'number' ? (v>1000? fmtInt(v): v) : v} />
                      <Legend />
                      <Line type="monotone" dataKey="activePM" name="Active PMs" stroke="#42B77E" strokeWidth={2} dot={false} />
                      <Line type="monotone" dataKey="revPM_month" name="Rev/PM (monthly)" stroke="#FFB84D" strokeWidth={2} dot={false} />
                    </LineChart>
                  </ResponsiveContainer>
                </div>
              </div>
            </>
          )}

          {/* STAFFING */}
          {tab==='staffing' && (
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-4">
              {[{y:'Year 1',data:y1,staff:staffY1},
                {y:'Year 2',data:y2,staff:staffY2},
                {y:'Year 3',data:y3,staff:staffY3}].map(card=>(
                  <div className="ui-card p-4 md:p-5" key={card.y}>
                    <div className="ui-sub mb-2">{card.y} — Load & Team</div>
                    <div className="grid grid-cols-2 gap-3">
                      <div><div className="text-xs text-slate-500">Revenue</div><div className="kpi-value">{fmtMoney(card.data.revenue)}</div></div>
                      <div><div className="text-xs text-slate-500">NP</div><div className="kpi-value">{fmtMoney(card.data.np)}</div></div>
                      <div><div className="text-xs text-slate-500">Jobs Sent</div><div className="kpi-value">{fmtInt(card.data.jobsSent)}</div></div>
                      <div><div className="text-xs text-slate-500">Jobs Approved</div><div className="kpi-value">{fmtInt(card.data.jobsApproved)}</div></div>
                    </div>
                    <div className="grid grid-cols-2 gap-3 mt-3">
                      <div><div className="text-xs text-slate-500">Dispatchers</div><div className="kpi-value">{fmtInt(card.staff.dispatchers)}</div></div>
                      <div><div className="text-xs text-slate-500">Team Leaders</div><div className="kpi-value">{fmtInt(card.staff.tls)}</div></div>
                      <div><div className="text-xs text-slate-500">Ops Managers</div><div className="kpi-value">{fmtInt(card.staff.oms)}</div></div>
                      <div><div className="text-xs text-slate-500">Account Managers</div><div className="kpi-value">{fmtInt(card.staff.ams)}</div></div>
                    </div>
                    <div className="text-xs text-slate-500 mt-2">End Active PMs: <b>{fmtInt(card.data.endActivePM)}</b></div>
                  </div>
              ))}
            </div>
          )}

          {/* GOAL TRACKER */}
          {tab==='goals' && (
            <div className="ui-card p-4 md:p-5">
              <div className="ui-sub mb-3">Goal Tracker (based on current settings)</div>
              <div className="overflow-x-auto">
                <table className="w-full text-sm">
                  <thead>
                    <tr className="text-left text-slate-500">
                      <th className="py-2">Metric</th>
                      <th>Goal</th>
                      <th>Achieved At</th>
                      <th>View</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr className="border-t">
                      <td className="py-2">Cumulative NP</td>
                      <td>$1,000,000</td>
                      <td>
                        {rolling1M_monthIdx>=0
                          ? <span className="badge badge--success">Month {rolling1M_monthIdx+1}</span>
                          : <span className="badge badge--warn">Not in 36 months</span>}
                      </td>
                      <td>Rolling (never resets)</td>
                    </tr>
                    <tr className="border-t">
                      <td className="py-2">Annual NP</td>
                      <td>$1,000,000</td>
                      <td>
                        {annual1M_yearIdx>=0
                          ? <span className="badge badge--success">Year {annual1M_yearIdx+1}</span>
                          : <span className="badge badge--warn">Not in Years 1–3</span>}
                      </td>
                      <td>Yearly (resets totals, keeps base)</td>
                    </tr>
                    <tr className="border-t">
                      <td className="py-2">Monthly NP</td>
                      <td>$100,000</td>
                      <td>
                        {monthlyNP_100k_monthIdx>=0
                          ? <span className="badge badge--success">Month {monthlyNP_100k_monthIdx+1}</span>
                          : <span className="badge badge--warn">Not in 36 months</span>}
                      </td>
                      <td>Single month milestone</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div className="ui-body text-slate-500 mt-3">
                Notes: <span className="badge badge--info">Rolling</span> never resets; <span className="badge badge--info">Yearly</span> totals reset each Jan but start from the prior active PM base; milestones update live as you change inputs.
              </div>
            </div>
          )}

          {/* MONTHLY DETAILS */}
          {tab==='details' && (
            <div className="ui-card p-4 md:p-5">
              <div className="ui-sub mb-3">Monthly Details (Months 1–36)</div>
              <div className="overflow-x-auto">
                <table className="w-full text-sm">
                  <thead>
                    <tr className="text-left text-slate-500">
                      <th className="py-2">t</th>
                      <th>Month</th>
                      <th>PMs Added</th>
                      <th>Active PMs</th>
                      <th>Rev/PM (mo)</th>
                      <th>Revenue</th>
                      <th>GP</th>
                      <th>NP</th>
                      <th>Jobs Approved</th>
                      <th>Jobs Sent</th>
                      <th>Cum Revenue</th>
                      <th>Cum NP</th>
                    </tr>
                  </thead>
                  <tbody>
                    {rows.map(r=>(
                      <tr key={r.t} className="border-t">
                        <td className="py-2">{r.t}</td>
                        <td>{r.monthName}</td>
                        <td>{fmtInt(r.addPM)}</td>
                        <td>{fmtInt(r.activePM)}</td>
                        <td>{fmtMoney(r.revPM_month)}</td>
                        <td>{fmtMoney(r.revenue)}</td>
                        <td>{fmtMoney(r.gp)}</td>
                        <td>{fmtMoney(r.np)}</td>
                        <td>{fmtInt(r.jobsApproved)}</td>
                        <td>{fmtInt(r.jobsSent)}</td>
                        <td>{fmtMoney(r.cumRevenue)}</td>
                        <td>{fmtMoney(r.cumNP)}</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>
          )}

          <div className="ui-body text-slate-500 pt-1">
            Tips: Adjust churn and expansion to see a leaky bucket vs. a compounding flywheel. The yearly view resets totals but carries the PM base forward.
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<ExecutivesWarGame />);
  </script>
</body>
</html>
